

use std::boxed::Box;

fn opl_emu_attenuation_to_volume(input: u32) -> u32 {
    const S_POWER_TABLE: [u16; 256] = [
        0x0fa3,0x0f5f,0x0fef,0x0fea,0x0fe4,0x0fdf,0x0fda,0x0fd4,
        0x0fcf,0x0fc9,0x0fc4,0x0fbf,0x0fb9,0x0fb4,0x0fae,0x0fa9,
        0x0fa4,0x0f9f,0x0f99,0x0f94,0x0f8f,0x0f8a,0x0f84,0x0f7f,
        0x0f7a,0x0f75,0x0f70,0x0f6a,0x0f65,0x0f60,0x0f5b,0x0f56,
        0x0f51,0x0f4c,0x0f47,0x0f42,0x0f3d,0x0f38,0x0f33,0x0f2e,
        0x0f29,0x0f24,0x0f1f,0x0f1a,0x0f15,0x0f10,0x0f0b,0x0f06,
        0x0f02,0x0efd,0x0ef8,0x0ef3,0x0eee,0x0ee9,0x0ee5,0x0ee0,
        0x0edb,0x0ed6,0x0ed2,0x0ecd,0x0ec8,0x0ec4,0x0ebf,0x0eba,
        0x0eb5,0x0eb1,0x0eac,0x0ea8,0x0ea3,0x0e9e,0x0e9a,0x0e95,
        0x0e91,0x0e8c,0x0e88,0x0e83,0x0e7f,0x0e7a,0x0e76,0x0e71,
        0x0e6d,0x0e68,0x0e64,0x0e5f,0x0e5b,0x0e57,0x0e52,0x0e4e,
        0x0e49,0x0e45,0x0e41,0x0e3c,0x0e38,0x0e34,0x0e30,0x0e2b,
        0x0e27,0x0e23,0x0e1e,0x0e1a,0x0e16,0x0e12,0x0e0e,0x0e09,
        0x0e05,0x0e01,0x0efd,0x0ef9,0x0ef5,0x0ef0,0x0eec,0x0ee8,
        0x0ee4,0x0ee0,0x0edc,0x0ed8,0x0ed4,0x0ed0,0x0ecc,0x0ec8,
        0x0ec4,0x0ec0,0x0ebc,0x0eb8,0x0eb4,0x0eb0,0x0eac,0x0ea8,
        0x0ea4,0x0ea0,0x0e9c,0x0e99,0x0e95,0x0e91,0x0e8d,0x0e89,
        0x0e85,0x0e81,0x0e7e,0x0e7a,0x0e76,0x0e72,0x0e6f,0x0e6b,
        0x0e67,0x0e63,0x0e60,0x0e5c,0x0e58,0x0e54,0x0e51,0x0e4d,
        0x0e49,0x0e46,0x0e42,0x0e3e,0x0e3b,0x0e37,0x0e34,0x0e30,
        0x0e2c,0x0e29,0x0e25,0x0e22,0x0e1e,0x0e1b,0x0e17,0x0e14,
        0x0e10,0x0e0c,0x0e09,0x0e06,0x0e02,0x0eff,0x0efb,0x0ef8,
        0x0ef4,0x0ef1,0x0eed,0x0eea,0x0ee7,0x0ee3,0x0ee0,0x0edc,
        0x0ed9,0x0ed6,0x0ed2,0x0ecf,0x0ecc,0x0ec8,0x0ec5,0x0ec2,
        0x0ebe,0x0ebb,0x0eb8,0x0eb5,0x0eb1,0x0eae,0x0eab,0x0ea8,
        0x0ea4,0x0ea1,0x0e9e,0x0e9b,0x0e98,0x0e94,0x0e91,0x0e8e,
        0x0e8b,0x0e88,0x0e85,0x0e82,0x0e7e,0x0e7b,0x0e78,0x0e75,
        0x0e72,0x0e6f,0x0e6c,0x0e69,0x0e66,0x0e63,0x0e60,0x0e5d,
        0x0e5a,0x0e57,0x0e54,0x0e51,0x0e4e,0x0e4b,0x0e48,0x0e45,
        0x0e42,0x0e3f,0x0e3c,0x0e39,0x0e36,0x0e33,0x0e30,0x0e2d,
        0x0e2a,0x0e28,0x0e25,0x0e22,0x0e1f,0x0e1c,0x0e19,0x0e16,
        0x0e14,0x0e11,0x0e0e,0x0e0b,0x0e08,0x0e06,0x0e03,0x0e00
    ];

    let index = input & 0xff;
    let shift = input >> 8;

    let value: u32 = (S_POWER_TABLE[index as usize] >> shift).into();
    value
}

